# Coturn Configuration for HealthCare Telemedicine
# Docs: https://github.com/coturn/coturn/wiki/turnserver

# IMPORTANTE: Substituir valores abaixo antes de usar em produção!

# Endereço de escuta (0.0.0.0 = todas as interfaces)
listening-ip=0.0.0.0

# IP externo - SUBSTITUIR pelo IP público do servidor
# Para descobrir: curl -4 ifconfig.me
external-ip=AUTO-DETECT

# Portas
listening-port=3478
tls-listening-port=5349
alt-listening-port=3479
alt-tls-listening-port=5350

# Autenticação long-term credentials
lt-cred-mech
use-auth-secret
static-auth-secret=MUDAR_PARA_SENHA_SEGURA_ALEATORIA

# Realm (domínio)
realm=healthcare.local
server-name=healthcare.local

# Usuário fixo (alternativa ao auth-secret)
# Descomente e configure se preferir credenciais fixas:
# user=healthcare:SENHA_SUPER_SEGURA_AQUI

# Certificados SSL/TLS (MUITO RECOMENDADO para produção)
# Obtenha grátis com Let's Encrypt: certbot certonly --standalone -d seu-dominio.com
# cert=/etc/letsencrypt/live/seu-dominio.com/fullchain.pem
# pkey=/etc/letsencrypt/live/seu-dominio.com/privkey.pem

# Cipher list (segurança)
cipher-list="ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384"

# Logging
log-file=/var/log/turnserver/turnserver.log
verbose
# Descomente para debug profundo:
# Verbose

# Performance e limites
# Largura de banda máxima por sessão (em bytes/s)
# 1 Mbps = 125000 bytes/s
# 5 Mbps = 625000 bytes/s (recomendado para HD)
max-bps=625000

# Quota total (MB) - quanto cada sessão pode transferir
total-quota=100

# Sessões simultâneas máximas
# Ajustar conforme capacidade do servidor:
# VPS básico (2GB RAM): 50
# VPS médio (4GB RAM): 100
# VPS alto (8GB RAM): 200+
max-allocate-lifetime=3600
max-allocate-timeout=60

# TTL de sessão (segundos)
# 3600s = 1 hora (consultas normalmente < 1h)
stale-nonce=600

# Range de portas para mídia RTP
# IMPORTANTE: Abrir no firewall!
min-port=49152
max-port=65535

# Fingerprinting
fingerprint
# Mobility support
mobility
# DTLS
no-dtls

# Segurança: Permitir apenas IPs de redes privadas + públicos
# Isso evita que seja usado como proxy aberto
no-multicast-peers
denied-peer-ip=0.0.0.0-0.255.255.255
denied-peer-ip=127.0.0.0-127.255.255.255
denied-peer-ip=169.254.0.0-169.254.255.255
denied-peer-ip=224.0.0.0-255.255.255.255

# Permitir redes privadas (LAN)
allowed-peer-ip=10.0.0.0-10.255.255.255
allowed-peer-ip=172.16.0.0-172.31.255.255
allowed-peer-ip=192.168.0.0-192.168.255.255

# Produção: descomentar para permitir internet pública
# allowed-peer-ip=0.0.0.0-255.255.255.255

# WebRTC específico
no-tcp-relay
no-cli
no-stdout-log

# Prometheus metrics (opcional - para monitoramento avançado)
# prometheus
# prometheus-port=9641

# ==========================================
# INSTRUÇÕES DE CONFIGURAÇÃO
# ==========================================
#
# 1. Gerar senha segura para static-auth-secret:
#    openssl rand -base64 32
#
# 2. Descobrir IP externo:
#    curl -4 ifconfig.me
#    Substituir AUTO-DETECT acima
#
# 3. Para TLS/SSL (OBRIGATÓRIO em produção):
#    a. Ter domínio apontando para o servidor
#    b. Instalar certbot: apt install certbot
#    c. Gerar certificado: certbot certonly --standalone -d seu-dominio.com
#    d. Descomentar linhas cert= e pkey= acima
#    e. Renovar automaticamente: certbot renew
#
# 4. Configurar firewall:
#    ufw allow 3478/tcp
#    ufw allow 3478/udp
#    ufw allow 5349/tcp
#    ufw allow 5349/udp
#    ufw allow 49152:65535/udp
#
# 5. Testar:
#    https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/
#
# 6. Adicionar ao .env do Next.js:
#    NEXT_PUBLIC_ICE="stun:stun.l.google.com:19302;turn:SEU_IP:3478,healthcare,SUA_SENHA"
#
# ==========================================
