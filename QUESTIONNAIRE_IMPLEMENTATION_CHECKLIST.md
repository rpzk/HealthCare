#!/bin/bash
# ===================================================================
# CHECKLIST: Dashboard de AnÃ¡lise de QuestionÃ¡rios
# Implemente este checklist para colocar o dashboard em produÃ§Ã£o
# ===================================================================

# Cores para output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${BLUE}âœ… CHECKLIST: Dashboard de AnÃ¡lise de QuestionÃ¡rios${NC}"
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""

# ===================================================================
# FASE 1: PREPARAÃ‡ÃƒO
# ===================================================================
echo -e "${BLUE}FASE 1: PREPARAÃ‡ÃƒO${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo "[ ] 1.1 - Fazer backup do projeto"
echo "    Comando: git stash ou manual backup"
echo ""
echo "[ ] 1.2 - Clonar repositÃ³rio"
echo "    Local: /tmp/questionnaire-dashboard"
echo ""
echo "[ ] 1.3 - Verificar versÃ£o Node"
echo "    NecessÃ¡rio: Node >= 18.17"
echo "    Comando: node --version"
echo ""
echo "[ ] 1.4 - Limpar cache npm (opcional)"
echo "    Comando: npm cache clean --force"
echo ""

# ===================================================================
# FASE 2: COPIAR ARQUIVOS
# ===================================================================
echo -e "${BLUE}FASE 2: COPIAR ARQUIVOS${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo "[ ] 2.1 - Criar diretÃ³rios"
echo "    Criar: components/questionnaires/"
echo "    Criar: app/api/questionnaires/"
echo "    Criar: app/admin/questionnaire-analytics/"
echo ""
echo "[ ] 2.2 - Copiar componentes (4 arquivos)"
echo "    De:   components/questionnaires/"
echo "    Para: seu-projeto/components/questionnaires/"
echo "    Arquivos:"
echo "      â€¢ questionnaire-analytics-dashboard.tsx"
echo "      â€¢ questionnaire-notifications-panel.tsx"
echo "      â€¢ questionnaire-insights.tsx"
echo "      â€¢ questionnaire-alert-widget.tsx"
echo ""
echo "[ ] 2.3 - Copiar APIs (7 endpoints)"
echo "    De:   app/api/questionnaires/"
echo "    Para: seu-projeto/app/api/questionnaires/"
echo "    Estrutura:"
echo "      â€¢ analytics/route.ts"
echo "      â€¢ notifications/route.ts"
echo "      â€¢ notifications/[id]/route.ts"
echo "      â€¢ notifications/mark-all-read/route.ts"
echo "      â€¢ insights/route.ts"
echo "      â€¢ alerts/summary/route.ts"
echo ""
echo "[ ] 2.4 - Copiar serviÃ§o (1 arquivo)"
echo "    De:   lib/questionnaire-notification-service.ts"
echo "    Para: seu-projeto/lib/"
echo ""
echo "[ ] 2.5 - Copiar pÃ¡gina principal (1 arquivo)"
echo "    De:   app/admin/questionnaire-analytics/page.tsx"
echo "    Para: seu-projeto/app/admin/questionnaire-analytics/"
echo ""
echo "[ ] 2.6 - Copiar documentaÃ§Ã£o (11 documentos)"
echo "    De:   Pasta raiz"
echo "    Para: Pasta raiz do projeto"
echo "    Usar para: ReferÃªncia e integration"
echo ""

# ===================================================================
# FASE 3: DEPENDÃŠNCIAS
# ===================================================================
echo -e "${BLUE}FASE 3: DEPENDÃŠNCIAS${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo "[ ] 3.1 - Verificar dependÃªncias existem"
echo "    Comando: npm ls recharts lucide-react next-auth"
echo "    Esperado: Todas instaladas"
echo ""
echo "[ ] 3.2 - Instalar se faltarem (improvÃ¡vel)"
echo "    npm install recharts lucide-react"
echo ""
echo "[ ] 3.3 - Gerar Prisma"
echo "    Comando: npx prisma generate"
echo ""

# ===================================================================
# FASE 4: BANCO DE DADOS
# ===================================================================
echo -e "${BLUE}FASE 4: BANCO DE DADOS${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo "[ ] 4.1 - Verificar tabelas existem"
echo "    Comando: psql -l | grep healthcare_db"
echo "    Esperado: Banco existe"
echo ""
echo "[ ] 4.2 - Verificar tabela PatientQuestionnaire"
echo "    Comando: psql healthcare_db -c \"\dt patient_questionnaire\""
echo "    Esperado: Tabela existe com colunas:"
echo "      â€¢ id"
echo "      â€¢ patientId"
echo "      â€¢ status"
echo "      â€¢ sentAt"
echo "      â€¢ completedAt"
echo "      â€¢ aiAnalysis (JSON)"
echo "      â€¢ aiAnalyzedAt"
echo "      â€¢ progressPercent"
echo ""
echo "[ ] 4.3 - Verificar tabela Notification (ou criar)"
echo "    Comando: psql healthcare_db -c \"\dt notification\""
echo "    Se nÃ£o existe, criar:"
echo "      psql healthcare_db < QUESTIONNAIRE_ANALYTICS_SCHEMA.sql"
echo ""
echo "[ ] 4.4 - Criar Ã­ndices recomendados"
echo "    Indices:"
echo "      â€¢ CREATE INDEX idx_pq_status ON patient_questionnaire(status);"
echo "      â€¢ CREATE INDEX idx_pq_sentAt ON patient_questionnaire(sentAt);"
echo "      â€¢ CREATE INDEX idx_pq_aiAnalysis ON patient_questionnaire(aiAnalyzedAt);"
echo "      â€¢ CREATE INDEX idx_notif_userId ON notification(userId);"
echo ""

# ===================================================================
# FASE 5: CONFIGURAÃ‡ÃƒO
# ===================================================================
echo -e "${BLUE}FASE 5: CONFIGURAÃ‡ÃƒO${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo "[ ] 5.1 - Verificar .env.local"
echo "    VariÃ¡veis necessÃ¡rias:"
echo "      â€¢ DATABASE_URL=postgresql://..."
echo "      â€¢ NEXTAUTH_SECRET=xxxxx"
echo "      â€¢ NEXTAUTH_URL=http://localhost:3000"
echo ""
echo "[ ] 5.2 - Validar NextAuth setup"
echo "    Arquivo: auth.ts"
echo "    Deve ter: authOptions com providers"
echo ""

# ===================================================================
# FASE 6: BUILD & TESTES
# ===================================================================
echo -e "${BLUE}FASE 6: BUILD & TESTES${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo "[ ] 6.1 - Type check"
echo "    Comando: npm run type-check"
echo "    Esperado: 0 errors"
echo ""
echo "[ ] 6.2 - Build"
echo "    Comando: npm run build"
echo "    Esperado: Build sucesso, sem erros"
echo ""
echo "[ ] 6.3 - Lint (opcional)"
echo "    Comando: npm run lint"
echo "    Esperado: Sem errors crÃ­ticos"
echo ""
echo "[ ] 6.4 - Start app"
echo "    Comando: npm start"
echo "    Esperado: App roda em http://localhost:3000"
echo ""

# ===================================================================
# FASE 7: TESTE MANUAL
# ===================================================================
echo -e "${BLUE}FASE 7: TESTE MANUAL${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo "[ ] 7.1 - Acessar dashboard"
echo "    URL: http://localhost:3000/admin/questionnaire-analytics"
echo "    Esperado: PÃ¡gina carrega sem erros"
echo ""
echo "[ ] 7.2 - Login (se necessÃ¡rio)"
echo "    Usar: Conta de teste com role DOCTOR ou ADMIN"
echo "    Esperado: Faz login e redirect para dashboard"
echo ""
echo "[ ] 7.3 - Verificar aba VisÃ£o Geral"
echo "    Elementos visÃ­veis:"
echo "      â€¢ 4 KPI cards (Total, Completados, Pendentes, Tempo)"
echo "      â€¢ 3 perÃ­odos (7D, 30D, 90D)"
echo "      â€¢ LineChart com dados"
echo "      â€¢ PieChart com sistemas"
echo "      â€¢ BarChart com status"
echo ""
echo "[ ] 7.4 - Verificar aba NotificaÃ§Ãµes"
echo "    Elementos visÃ­veis:"
echo "      â€¢ Filtros (NÃ£o lidas, Lidas, Todas)"
echo "      â€¢ Lista de notificaÃ§Ãµes"
echo "      â€¢ BotÃµes de aÃ§Ã£o"
echo "      â€¢ Badge com contagem"
echo ""
echo "[ ] 7.5 - Verificar aba Insights"
echo "    Elementos visÃ­veis:"
echo "      â€¢ Filtros de severidade"
echo "      â€¢ Lista de insights (se houver dados)"
echo "      â€¢ Cores visuais (vermelho, amarelo, azul)"
echo ""
echo "[ ] 7.6 - Testar filtro de perÃ­odo"
echo "    AÃ§Ã£o: Clicar em 7D, 30D, 90D"
echo "    Esperado: GrÃ¡ficos atualizam"
echo ""
echo "[ ] 7.7 - Testar notificaÃ§Ãµes (opcional)"
echo "    AÃ§Ã£o: Marcar notificaÃ§Ã£o como lida"
echo "    Esperado: Ãcone muda, badge diminui"
echo ""
echo "[ ] 7.8 - Abrir DevTools"
echo "    F12 â†’ Console"
echo "    Esperado: Sem erros"
echo "    Esperado: Sem warnings crÃ­ticos"
echo ""
echo "[ ] 7.9 - Testar Network"
echo "    F12 â†’ Network"
echo "    Acao: Carregar pÃ¡gina"
echo "    Esperado: APIs retornam 200"
echo "    Esperado: Tempo < 200ms por requisiÃ§Ã£o"
echo ""

# ===================================================================
# FASE 8: INTEGRAÃ‡ÃƒO
# ===================================================================
echo -e "${BLUE}FASE 8: INTEGRAÃ‡ÃƒO${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo "[ ] 8.1 - Adicionar link no menu"
echo "    Arquivo: navigation.tsx ou menu component"
echo "    Adicionar:"
echo "      <NavItem href=\"/admin/questionnaire-analytics\">"
echo "        <BarChart3 size={20} />"
echo "        AnÃ¡lise de QuestionÃ¡rios"
echo "      </NavItem>"
echo ""
echo "[ ] 8.2 - Integrar notificaÃ§Ãµes na API de envio"
echo "    Arquivo: Seu API de envio de questionÃ¡rio"
echo "    Adicionar:"
echo "      import { QuestionnaireNotificationService } from '@/lib/questionnaire-notification-service'"
echo "      await QuestionnaireNotificationService.notifyQuestionnaireSent(...)"
echo ""
echo "[ ] 8.3 - Integrar notificaÃ§Ãµes na API de conclusÃ£o"
echo "    Arquivo: Seu API de conclusÃ£o de questionÃ¡rio"
echo "    Adicionar: notifyQuestionnaireCompleted(...)"
echo ""
echo "[ ] 8.4 - Integrar notificaÃ§Ãµes de anÃ¡lise IA"
echo "    Arquivo: Seu API de anÃ¡lise IA"
echo "    Adicionar: notifyAIAnalysisReady(...)"
echo ""
echo "[ ] 8.5 - Testar integraÃ§Ã£o"
echo "    AÃ§Ã£o: Enviar questionÃ¡rio de teste"
echo "    Esperado: NotificaÃ§Ã£o aparece no painel"
echo ""

# ===================================================================
# FASE 9: OTIMIZAÃ‡ÃƒO & SEGURANÃ‡A
# ===================================================================
echo -e "${BLUE}FASE 9: OTIMIZAÃ‡ÃƒO & SEGURANÃ‡A${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo "[ ] 9.1 - Verificar autenticaÃ§Ã£o"
echo "    AÃ§Ã£o: Tentar acessar sem login"
echo "    Esperado: Redireciona para /forbidden"
echo ""
echo "[ ] 9.2 - Verificar autorizaÃ§Ã£o"
echo "    AÃ§Ã£o: Acessar com role USER (sem permissÃ£o)"
echo "    Esperado: Acesso negado"
echo ""
echo "[ ] 9.3 - Verificar rate limit (opcional)"
echo "    APIs podem ter rate limit se aplicÃ¡vel"
echo ""
echo "[ ] 9.4 - Cache optimization (opcional)"
echo "    Se necessÃ¡rio, adicionar cache headers"
echo ""

# ===================================================================
# FASE 10: DEPLOY
# ===================================================================
echo -e "${BLUE}FASE 10: DEPLOY${NC}"
echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
echo ""
echo "[ ] 10.1 - Build para produÃ§Ã£o"
echo "    Comando: npm run build"
echo "    Esperado: Build sucesso"
echo ""
echo "[ ] 10.2 - Testar build em produÃ§Ã£o"
echo "    Comando: npm start"
echo "    URL: http://localhost:3000"
echo "    Esperado: Tudo funciona em modo prod"
echo ""
echo "[ ] 10.3 - Deploy em staging (opcional)"
echo "    Processo especÃ­fico da sua infra"
echo ""
echo "[ ] 10.4 - Deploy em produÃ§Ã£o"
echo "    Processo especÃ­fico da sua infra"
echo ""
echo "[ ] 10.5 - Verificar em produÃ§Ã£o"
echo "    URL: https://seu-dominio.com/admin/questionnaire-analytics"
echo "    Esperado: Tudo funciona normal"
echo ""

# ===================================================================
# RESUMO FINAL
# ===================================================================
echo ""
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${GREEN}âœ… CHECKLIST COMPLETO${NC}"
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo "Se marcou todas as caixas, seu dashboard estÃ¡ pronto! ğŸš€"
echo ""
echo "PrÃ³ximos passos:"
echo "1. Marcar todas as caixas acima"
echo "2. Seguir instruÃ§Ãµes de cada fase"
echo "3. Testar em cada etapa"
echo "4. Fazer commit no git"
echo "5. Notificar time de conclusÃ£o"
echo ""
echo "DÃºvidas? Leia:"
echo "â€¢ QUESTIONNAIRE_QUICK_START.md (setup rÃ¡pido)"
echo "â€¢ QUESTIONNAIRE_INTEGRATION_GUIDE.md (integraÃ§Ã£o)"
echo "â€¢ QUESTIONNAIRE_ANALYTICS_GUIDE.md (como usar)"
echo ""
echo "Sucesso! ğŸ‰"
echo ""
